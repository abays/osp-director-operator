#
# Check for:
#
# - ControlPlane
# - VMSet
# - VirtualMachines
# - OvercloudNet (IP reservations)
# - OvercloudIpSet (IP reservations)
#

apiVersion: osp-director.openstack.org/v1beta1
kind: ControlPlane
metadata:
  name: overcloud
  namespace: openstack
spec:
  controller:
    controllerCount: 3
---
apiVersion: osp-director.openstack.org/v1beta1
kind: VMSet
metadata:
  name: controller
  namespace: openstack
spec:
  vmCount: 3
status:
  baseImageDVReady: true
  vmHosts:
    controller-0:
      hostname: controller-0
      # VMSet VMs and their associated OpenstackClient Pod acquire IPs nondeterministically,
      # so we cannot check this here
      # ipaddress: 192.168.25.100/24
    controller-1:
      hostname: controller-1
      # ipaddress: 192.168.25.102/24
    controller-2:
      hostname: controller-2
      # ipaddress: 192.168.25.103/24
---
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  name: controller-0
  namespace: openstack
status:
  conditions:
  - status: "True"
    type: Ready
  created: true
  ready: true
---
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  name: controller-1
  namespace: openstack
status:
  conditions:
  - status: "True"
    type: Ready
  created: true
  ready: true
---
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  name: controller-2
  namespace: openstack
status:
  conditions:
  - status: "True"
    type: Ready
  created: true
  ready: true
---
# Can't check OvercloudNet for IPs, because VMSet VMs and their associated OpenstackClient Pod acquire IPs nondeterministically.
# Thus the reservation list order is nondeterministic
# apiVersion: osp-director.openstack.org/v1beta1
# kind: OvercloudNet
# metadata:
#   name: ctlplane
#   namespace: openstack
# status:
#   reservations:
---
apiVersion: osp-director.openstack.org/v1beta1
kind: OvercloudIPSet
metadata:
  labels:
    addToPredictableIPsLabel: "true"
  name: controller
  namespace: openstack
spec:
  hostCount: 3
  networks:
  - ctlplane
  role: controller
# VMSet VMs and their associated OpenstackClient Pod acquire IPs nondeterministically,
# so we cannot check this here
# status:
#   hosts:
#     controller-0:
#       ipaddresses:
#         ctlplane: 192.168.25.100/24
#     controller-1:
#       ipaddresses:
#         ctlplane: 192.168.25.102/24
#     controller-2:
#       ipaddresses:
#         ctlplane: 192.168.25.103/24