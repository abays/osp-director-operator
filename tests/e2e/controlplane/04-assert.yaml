#
# Check for:
#
# - ControlPlane
# - VMSet
# - VirtualMachine
# - OvercloudNet (IP reservations)
# - OvercloudIpSet (IP reservations)
#

apiVersion: osp-director.openstack.org/v1beta1
kind: ControlPlane
metadata:
  name: overcloud
  namespace: openstack
spec:
  controller:
    controllerCount: 1
---
apiVersion: osp-director.openstack.org/v1beta1
kind: VMSet
metadata:
  name: controller
  namespace: openstack
spec:
  vmCount: 1
status:
  baseImageDVReady: true
  vmHosts:
    controller-2:
      hostname: controller-2
      # VMSet VMs and their associated OpenstackClient Pod acquire IPs nondeterministically,
      # so we cannot check this here
      # ipaddress: 192.168.25.103/24
---
apiVersion: kubevirt.io/v1alpha3
kind: VirtualMachine
metadata:
  name: controller-2
  namespace: openstack
status:
  conditions:
  - status: "True"
    type: Ready
  created: true
  ready: true
---
# All 4 IPs should still be reserved
apiVersion: osp-director.openstack.org/v1beta1
kind: OvercloudNet
metadata:
  name: ctlplane
  namespace: openstack
status:
  reservations:
  - ip: 192.168.25.100
  - ip: 192.168.25.101
  - ip: 192.168.25.102
  - ip: 192.168.25.103
---
# Can't check for IPs here as assignments are nondeterministic
apiVersion: osp-director.openstack.org/v1beta1
kind: OvercloudIPSet
metadata:
  labels:
    addToPredictableIPsLabel: "true"
  name: controller
  namespace: openstack
spec:
  hostCount: 1
  networks:
  - ctlplane
  role: controller